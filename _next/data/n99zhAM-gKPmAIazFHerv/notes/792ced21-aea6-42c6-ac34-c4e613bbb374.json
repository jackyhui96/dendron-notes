{"pageProps":{"note":{"id":"792ced21-aea6-42c6-ac34-c4e613bbb374","title":"Wireguard","desc":"","updated":1614451360150,"created":1613812652776,"custom":{},"fname":"app.wireguard","type":"note","vault":{"fsPath":".","name":"vault","selfContained":true},"contentHash":"861f989065805e211bacc852cc3c2b49","links":[],"anchors":{"wireguard":{"type":"header","text":"Wireguard","value":"wireguard","line":8,"column":0,"depth":1},"possible-pre-req":{"type":"header","text":"Possible pre-req","value":"possible-pre-req","line":10,"column":0,"depth":2},"running-with-docker":{"type":"header","text":"Running with Docker","value":"running-with-docker","line":21,"column":0,"depth":2},"output":{"type":"header","text":"Output","value":"output","line":62,"column":0,"depth":2},"mtu-fixes":{"type":"header","text":"MTU fixes","value":"mtu-fixes","line":67,"column":0,"depth":2},"references":{"type":"header","text":"References","value":"references","line":78,"column":0,"depth":2}},"children":[],"parent":"ced683be-fe67-4022-989f-abc6d311cb3a","data":{}},"body":"<h1 id=\"wireguard\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#wireguard\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Wireguard</h1>\n<h1 id=\"wireguard-1\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#wireguard-1\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Wireguard</h1>\n<h2 id=\"possible-pre-req\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#possible-pre-req\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Possible pre-req</h2>\n<p>After getting a vague error which said <code>Kernel headers not available, sleeping now</code>, the following possible solution is below</p>\n<pre class=\"language-sh\"><code class=\"language-sh\">## Not sure if the below fixed it or not but this was run first\nsudo apt install --reinstall libraspberrypi0 libraspberrypi-{bin,dev,doc} raspberrypi-bootloader raspberrypi-kernel\n\n## Running the below and restarting fixed the issue \nsudo apt update &#x26;&#x26; sudo apt upgrade -y\n\n</code></pre>\n<h2 id=\"running-with-docker\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#running-with-docker\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Running with Docker</h2>\n<pre class=\"language-sh\"><code class=\"language-sh\">docker run -d \\\n--name=wireguard \\\n--cap-add=NET_ADMIN \\\n--cap-add=SYS_MODULE \\\n-e PUID=1000 \\\n-e PGID=1000 \\\n-e TZ=[YOURTZ] \\\n-e SERVERURL=[YOURIP] \\\n-e SERVERPORT=51820 \\\n-e PEERS=[PEERS] \\\n-e PEERDNS=auto \\\n-e INTERNAL_SUBNET=10.13.13.0 \\\n-p 51820:51820/udp \\\n-v [VOLUME]:/config \\\n-v /lib/modules:/lib/modules \\\n--restart unless-stopped \\\nlinuxserver/wireguard\n\n## e.g.\n\ndocker run -d \\\n--name=wireguard \\\n--cap-add=NET_ADMIN \\\n--cap-add=SYS_MODULE \\\n-e PUID=1000 \\\n-e PGID=1000 \\\n-e TZ=Europe/London \\\n-e SERVERURL=xujunjie-pi.hopto.org \\\n-e SERVERPORT=51820 \\\n-e PEERS=3 \\\n-e PEERDNS=192.168.208.102 \\\n-e INTERNAL_SUBNET=10.13.13.0 \\\n-p 51820:51820/udp \\\n-v /usr/local/docker_apps/wireguard/config:/config \\\n-v /lib/modules:/lib/modules \\\n--restart unless-stopped \\\nlinuxserver/wireguard\n</code></pre>\n<h2 id=\"output\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#output\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Output</h2>\n<p>After you execute the docker run command, the container will install the required kernel headers for your operating system to be able to effectively run Wireguard. Depending on your system this process could take a few minutes.</p>\n<p>After the container setup process is completed, the terminal will display QR codes. Do not close your window, you will need to scan these QR codes later. You can scan these QR codes with the mobile applications to instantly create the Wireguard profile on your mobile devices. The QR codes are the easiest and quickest way to get Wireguard up and running on your mobile devices.</p>\n<h2 id=\"mtu-fixes\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#mtu-fixes\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>MTU fixes</h2>\n<pre class=\"language-sh\"><code class=\"language-sh\">## Add the below to the PostUp section of the server config\niptables -A FORWARD -p tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu\n\n## Add the below to the PostDown section of the server config\niptables -D FORWARD -p tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu\n</code></pre>\n<p><em>Reference: <a href=\"https://keremerkan.net/posts/wireguard-mtu-fixes/\">https://keremerkan.net/posts/wireguard-mtu-fixes/</a></em></p>\n<h2 id=\"references\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#references\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>References</h2>\n<p><em><a href=\"https://codeopolis.com/posts/installing-wireguard-in-docker/\">https://codeopolis.com/posts/installing-wireguard-in-docker/</a></em>\n<em><a href=\"https://github.com/linuxserver/docker-wireguard\">https://github.com/linuxserver/docker-wireguard</a></em></p>","noteIndex":{"id":"root","title":"root","desc":"","updated":1595961348801,"created":1595961348801,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":".","name":"vault","selfContained":true},"contentHash":"dad9815845eec627c937e34281a065d5","links":[],"anchors":{"root":{"type":"header","text":"Root","value":"root","line":8,"column":0,"depth":1}},"children":["ced683be-fe67-4022-989f-abc6d311cb3a","132fe0fe-fc74-4dbe-982a-9dcac677f664","a44df307-1a67-417b-b733-da109c3be441","b9686e84-d9a1-4dbb-8474-1a9c156d6d12","93a5dc42-8663-4d3c-924f-82e8faa35a67","f80d45a1-bd90-4097-96bc-0301fbc4d937","19992660-3602-4c64-a3a5-e9c05f19ffac","3f157f98-5c61-4479-b311-956d4b0ef67a"],"parent":null,"data":{},"body":"\n# Root\n\nThis is the root fo your dendron vault. If you decide to publish your entire vault, this will be your landing page. You are free to customize any part of this page except the frontmatter on top. \n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":false,"leaveTrace":true,"bubbleUpCreateNew":true,"vaultSelectionModeOnCreate":"smart","fuzzThreshold":0.2}},"randomNote":{},"insertNote":{"initialValue":"templates"},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"copyNoteLink":{}},"workspace":{"vaults":[{"fsPath":".","name":"vault","selfContained":true}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"task":{"name":"","dateFormat":"","addBehavior":"childOfCurrent","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link"},"graph":{"zoomSpeed":1},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"enableUserTags":true,"enableHashTags":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":false,"maxPreviewsCached":10,"maxNoteLength":204800,"dendronVersion":"0.87.3","enableEditorDecorations":true,"enableFullHierarchyNoteTitle":false},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false,"enableFrontmatterTags":true,"enableHashesForFMTags":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"assetsPrefix":"/dendron-notes","copyAssets":true,"siteHierarchies":["root"],"enableSiteLastModified":true,"siteRootDir":"docs","siteUrl":"https://jackyhui96.github.io","enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"duplicateNoteBehavior":{"action":"useVault","payload":["vault"]},"writeStubs":false,"seo":{"title":"Dendron Notes","description":"Personal knowledge space"},"github":{"enableEditLink":true,"editLinkText":"Edit this page on GitLab","editBranch":"main","editViewMode":"tree"},"enablePrettyLinks":true,"siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true}