{"pageProps":{"note":{"id":"yPSbfSUiv5mdVJHX2LaBF","title":"Iptables","desc":"","updated":1624740148102,"created":1624732067440,"custom":{},"fname":"cli.iptables","type":"note","vault":{"fsPath":".","name":"vault","selfContained":true},"contentHash":"8dbb813d733ef7ad6420b9ff78d6d7d7","links":[],"anchors":{"overview":{"type":"header","text":"Overview","value":"overview","line":8,"column":0,"depth":1},"synopsis":{"type":"header","text":"Synopsis","value":"synopsis","line":11,"column":0,"depth":1},"options":{"type":"header","text":"Options","value":"options","line":16,"column":0,"depth":1},"flags":{"type":"header","text":"Flags","value":"flags","line":18,"column":0,"depth":2},"tables":{"type":"header","text":"Tables","value":"tables","line":21,"column":0,"depth":2},"examples":{"type":"header","text":"Examples","value":"examples","line":51,"column":0,"depth":1},"other-notes":{"type":"header","text":"Other Notes","value":"other-notes","line":79,"column":0,"depth":1},"ip-forwarding":{"type":"header","text":"IP Forwarding","value":"ip-forwarding","line":81,"column":0,"depth":2},"check-if-ip-forwarding-is-enabled":{"type":"header","text":"Check if IP forwarding is enabled","value":"check-if-ip-forwarding-is-enabled","line":84,"column":0,"depth":3},"enable-ip-forwarding":{"type":"header","text":"Enable IP forwarding","value":"enable-ip-forwarding","line":94,"column":0,"depth":3}},"children":[],"parent":"132fe0fe-fc74-4dbe-982a-9dcac677f664","data":{},"schema":{"schemaId":"cli","moduleId":"cli"}},"body":"<h1 id=\"iptables\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#iptables\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Iptables</h1>\n<h1 id=\"overview\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#overview\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Overview</h1>\n<ul>\n<li>iptables - administration tool for IPv4 packet filtering and NAT</li>\n</ul>\n<h1 id=\"synopsis\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#synopsis\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Synopsis</h1>\n<pre><code>iptables [-t table] -[AD] chain rule-specification [options]\n</code></pre>\n<h1 id=\"options\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#options\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Options</h1>\n<h2 id=\"flags\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#flags\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Flags</h2>\n<ul>\n<li><code>-t | --table &#x3C;table></code>: This option specifies the packet matching table which the command should operate on.</li>\n</ul>\n<h2 id=\"tables\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#tables\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Tables</h2>\n<p>The tables are as follows:</p>\n<p><code>filter</code>:\nThis is the <strong>default table</strong> (if no <code>-t</code> option is passed).</p>\n<ul>\n<li>INPUT (for packets destined to local sockets)</li>\n<li>FORWARD (for packets being routed through the box)</li>\n<li>OUTPUT (for locally-generated packets)</li>\n</ul>\n<p><code>nat</code>:\nThis table is consulted when a packet that creates a new connection is encountered.</p>\n<ul>\n<li>PREROUTING (for altering packets as soon as they come in)</li>\n<li>OUTPUT (for altering locally-generated packets before routing)</li>\n<li>POSTROUTING (for altering packets as they are about to go out)</li>\n</ul>\n<p><code>mangle</code>:\nThis table is used for specialized packet alteration. Until kernel 2.4.17 it had two built-in chains: </p>\n<ul>\n<li>PREROUTING (for altering incoming packets before routing)</li>\n<li>OUTPUT (for altering locally-generated packets before routing). </li>\n</ul>\n<p>Since kernel 2.4.18, three other built-in chains are also supported: </p>\n<ul>\n<li>INPUT (for packets coming into the box itself)</li>\n<li>FORWARD (for altering packets being routed through the box)</li>\n<li>POSTROUTING (for altering packets as they are about to go out)</li>\n</ul>\n<p><code>raw</code>:\nThis table is used mainly for configuring exemptions from connection tracking in combination with the NOTRACK target. It registers at the netfilter hooks with higher priority and is thus called before ip_conntrack, or any other IP tables.</p>\n<ul>\n<li>PREROUTING (for packets arriving via any network interface)</li>\n<li>OUTPUT (for packets generated by local processes)</li>\n</ul>\n<h1 id=\"examples\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#examples\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Examples</h1>\n<pre class=\"language-sh\"><code class=\"language-sh\">## List Rules\niptables -L --line-numbers\n\n## List Rules in nat table\nsudo iptables -t nat -L -n\n\n## Delete a rule by number\niptables -D [CHAIN NAME] [RULE NUMBER]\n## e.g. Delete 11th rule at the \"FORWARD\" chain.\niptables -D FORWARD 11\n\n## Port forward to another IP\n## TCP\niptables -t nat -I PREROUTING -p tcp -m tcp --dst &#x3C;node_a> --dport &#x3C;port_a>[:&#x3C;port_b>] -j DNAT --to-destination &#x3C;node_b>:&#x3C;port_a>[-&#x3C;port_b>]\niptables -t nat -A POSTROUTING -m tcp -p tcp --dst &#x3C;node_b> --dport &#x3C;port_a>[:&#x3C;port_b>] -j SNAT --to-source &#x3C;node_a>\n## Not sure if need the below\niptables -A FORWARD -m tcp -p tcp --dst &#x3C;node_b> --dport &#x3C;port_a>:&#x3C;port_b> -j ACCEPT\n## e.g. NodeA (192.168.0.3:31000-31999) -> NodeB (172.20.0.11:31000-31999)\niptables -t nat -I PREROUTING -p tcp -m tcp --dst 192.168.0.3 --dport 31000:31999 -j DNAT --to-destination 172.20.0.11:31000-31999\niptables -t nat -A POSTROUTING -m tcp -p tcp --dst 172.20.0.11 --dport 31000:31999 -j SNAT --to-source 192.168.0.3\niptables -A FORWARD -m tcp -p tcp --dst 172.20.0.11 --dport  31000:31999 -j ACCEPT\n## Another example with masqerade: 3124 -> 1.1.1.1:3000\niptables -t nat -A PREROUTING -p tcp --dport 3124 -j DNAT --to-destination 1.1.1.1:3000\niptables -t nat -A POSTROUTING -j MASQUERADE\n</code></pre>\n<h1 id=\"other-notes\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#other-notes\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Other Notes</h1>\n<h2 id=\"ip-forwarding\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#ip-forwarding\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>IP Forwarding</h2>\n<p>NAT uses IP forwarding and by default itâ€™s not enabled in the kernel parameters</p>\n<h3 id=\"check-if-ip-forwarding-is-enabled\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#check-if-ip-forwarding-is-enabled\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Check if IP forwarding is enabled</h3>\n<pre class=\"language-sh\"><code class=\"language-sh\">## CentOS/RHEL\nsysctl net.ipv4.ip_forward\n## Debian:\nsudo sysctl net.ipv4.ip_forward\n## Return: net.ipv4.ip_forward = 0   # where 0 means disabled\nnet.ipv4.ip_forward = 0\n</code></pre>\n<h3 id=\"enable-ip-forwarding\"><a aria-hidden=\"true\" class=\"anchor-heading\" href=\"#enable-ip-forwarding\"><svg aria-hidden=\"true\" viewBox=\"0 0 16 16\"><use xlink:href=\"#svg-link\"></use></svg></a>Enable IP forwarding</h3>\n<pre class=\"language-sh\"><code class=\"language-sh\">### To enable IP persistently (survives a reboot):\n## CentOS/RHEL:\necho \"net.ipv4.ip_forward = 1\"|sudo tee /etc/sysctl.d/99-ipforward.conf\n## Debian:\nsudo sed -i 's/#net.ipv4.ip_forward=1/net.ipv4.ip_forward=1/g' /etc/sysctl.conf\n\n### To activate the changes immediately afer making the aboves changes:\n## CentOS/RHEL:\nsudo sysctl -p /etc/sysctl.d/99-ipforward.conf\n## Debian:\nsudo sysctl -p\n</code></pre>","noteIndex":{"id":"root","title":"root","desc":"","updated":1595961348801,"created":1595961348801,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":".","name":"vault","selfContained":true},"contentHash":"dad9815845eec627c937e34281a065d5","links":[],"anchors":{"root":{"type":"header","text":"Root","value":"root","line":8,"column":0,"depth":1}},"children":["ced683be-fe67-4022-989f-abc6d311cb3a","132fe0fe-fc74-4dbe-982a-9dcac677f664","a44df307-1a67-417b-b733-da109c3be441","b9686e84-d9a1-4dbb-8474-1a9c156d6d12","93a5dc42-8663-4d3c-924f-82e8faa35a67","f80d45a1-bd90-4097-96bc-0301fbc4d937","19992660-3602-4c64-a3a5-e9c05f19ffac","3f157f98-5c61-4479-b311-956d4b0ef67a"],"parent":null,"data":{},"body":"\n# Root\n\nThis is the root fo your dendron vault. If you decide to publish your entire vault, this will be your landing page. You are free to customize any part of this page except the frontmatter on top. \n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":false,"leaveTrace":true,"bubbleUpCreateNew":true,"vaultSelectionModeOnCreate":"smart","fuzzThreshold":0.2}},"randomNote":{},"insertNote":{"initialValue":"templates"},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"copyNoteLink":{}},"workspace":{"vaults":[{"fsPath":".","name":"vault","selfContained":true}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"task":{"name":"","dateFormat":"","addBehavior":"childOfCurrent","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link"},"graph":{"zoomSpeed":1},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"enableUserTags":true,"enableHashTags":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":false,"maxPreviewsCached":10,"maxNoteLength":204800,"dendronVersion":"0.87.3","enableEditorDecorations":true,"enableFullHierarchyNoteTitle":false},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false,"enableFrontmatterTags":true,"enableHashesForFMTags":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"assetsPrefix":"/dendron-notes","copyAssets":true,"siteHierarchies":["root"],"enableSiteLastModified":true,"siteRootDir":"docs","siteUrl":"https://jackyhui96.github.io","enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"duplicateNoteBehavior":{"action":"useVault","payload":["vault"]},"writeStubs":false,"seo":{"title":"Dendron Notes","description":"Personal knowledge space"},"github":{"enableEditLink":true,"editLinkText":"Edit this page on GitLab","editBranch":"main","editViewMode":"tree"},"enablePrettyLinks":true,"siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true}