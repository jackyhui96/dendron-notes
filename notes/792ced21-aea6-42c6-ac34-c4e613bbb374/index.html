<!DOCTYPE html><html><head><meta name="viewport" content="width=device-width"/><meta charSet="utf-8"/><link rel="icon" href="/favicon.ico"/><title>Wireguard</title><meta name="robots" content="index,follow"/><meta name="googlebot" content="index,follow"/><meta name="description" content="Personal knowledge space"/><meta property="og:title" content="Wireguard"/><meta property="og:description" content="Personal knowledge space"/><meta property="og:url" content="https://jackyhui96.github.io/dendron-notes/notes/792ced21-aea6-42c6-ac34-c4e613bbb374/"/><meta property="og:type" content="article"/><meta property="article:published_time" content="2/20/2021"/><meta property="article:modified_time" content="2/27/2021"/><link rel="canonical" href="https://jackyhui96.github.io/dendron-notes/notes/792ced21-aea6-42c6-ac34-c4e613bbb374/"/><meta name="next-head-count" content="14"/><link rel="preload" href="/dendron-notes/_next/static/css/311cdff2e267b2b9.css" as="style"/><link rel="stylesheet" href="/dendron-notes/_next/static/css/311cdff2e267b2b9.css" data-n-g=""/><noscript data-n-css=""></noscript><script defer="" nomodule="" src="/dendron-notes/_next/static/chunks/polyfills-5cd94c89d3acac5f.js"></script><script src="/dendron-notes/_next/static/chunks/webpack-c34b18ce8e2d9d8e.js" defer=""></script><script src="/dendron-notes/_next/static/chunks/framework-bb5c596eafb42b22.js" defer=""></script><script src="/dendron-notes/_next/static/chunks/main-e23e59a6994e534a.js" defer=""></script><script src="/dendron-notes/_next/static/chunks/pages/_app-0346e2e0ce770356.js" defer=""></script><script src="/dendron-notes/_next/static/chunks/155-3a6c02d7e042edb7.js" defer=""></script><script src="/dendron-notes/_next/static/chunks/pages/notes/%5Bid%5D-dc9b1cbe134a7143.js" defer=""></script><script src="/dendron-notes/_next/static/n99zhAM-gKPmAIazFHerv/_buildManifest.js" defer=""></script><script src="/dendron-notes/_next/static/n99zhAM-gKPmAIazFHerv/_ssgManifest.js" defer=""></script><script src="/dendron-notes/_next/static/n99zhAM-gKPmAIazFHerv/_middlewareManifest.js" defer=""></script></head><body><div id="__next" data-reactroot=""><section class="ant-layout" style="width:100%;min-height:100%"><header class="ant-layout-header" style="position:fixed;isolation:isolate;z-index:1;width:100%;border-bottom:1px solid #d4dadf;height:64px;padding:0 24px 0 2px"><div class="ant-row ant-row-center" style="max-width:992px;justify-content:space-between;margin:0 auto"><div style="display:flex" class="ant-col ant-col-xs-20 ant-col-sm-4"></div><div class="ant-col gutter-row ant-col-xs-0 ant-col-sm-20 ant-col-md-20 ant-col-lg-19"><div class="ant-select ant-select-lg ant-select-auto-complete ant-select-single ant-select-allow-clear ant-select-show-search" style="width:100%"><div class="ant-select-selector"><span class="ant-select-selection-search"><input type="search" autoComplete="off" class="ant-select-selection-search-input" role="combobox" aria-haspopup="listbox" aria-owns="undefined_list" aria-autocomplete="list" aria-controls="undefined_list" aria-activedescendant="undefined_list_0" value=""/></span><span class="ant-select-selection-placeholder">For full text search please use the &#x27;?&#x27; prefix. e.g. ? Onboarding</span></div></div></div><div style="display:none;align-items:center;justify-content:center" class="ant-col ant-col-xs-4 ant-col-sm-4 ant-col-md-0 ant-col-lg-0"><span role="img" aria-label="menu" style="font-size:24px" tabindex="-1" class="anticon anticon-menu"><svg viewBox="64 64 896 896" focusable="false" data-icon="menu" width="1em" height="1em" fill="currentColor" aria-hidden="true"><path d="M904 160H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0 624H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8zm0-312H120c-4.4 0-8 3.6-8 8v64c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-64c0-4.4-3.6-8-8-8z"></path></svg></span></div></div></header><section class="ant-layout site-layout" style="margin-top:64px"><section class="ant-layout site-layout" style="flex-direction:row"><section class="ant-layout site-layout-sidebar" style="flex:0 0 auto;width:calc(max((100% - 992px) / 2, 0px) + 200px);min-width:200px;padding-left:calc((100% - 992px) / 2)"><aside class="ant-layout-sider ant-layout-sider-dark" style="position:fixed;overflow:auto;height:calc(100vh - 64px);flex:0 0 200px;max-width:200px;min-width:200px;width:200px"><div class="ant-layout-sider-children"></div></aside></section><section class="ant-layout side-layout-main" style="max-width:1200px;display:initial"><main class="ant-layout-content main-content" role="main" style="padding:0 24px"><div class="ant-row"><div class="ant-col ant-col-24"><div class="ant-row" style="margin-left:-10px;margin-right:-10px"><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-24 ant-col-md-18"><div><h1 id="wireguard"><a aria-hidden="true" class="anchor-heading" href="#wireguard"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Wireguard</h1>
<h1 id="wireguard-1"><a aria-hidden="true" class="anchor-heading" href="#wireguard-1"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Wireguard</h1>
<h2 id="possible-pre-req"><a aria-hidden="true" class="anchor-heading" href="#possible-pre-req"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Possible pre-req</h2>
<p>After getting a vague error which said <code>Kernel headers not available, sleeping now</code>, the following possible solution is below</p>
<pre class="language-sh"><code class="language-sh">## Not sure if the below fixed it or not but this was run first
sudo apt install --reinstall libraspberrypi0 libraspberrypi-{bin,dev,doc} raspberrypi-bootloader raspberrypi-kernel

## Running the below and restarting fixed the issue 
sudo apt update &#x26;&#x26; sudo apt upgrade -y

</code></pre>
<h2 id="running-with-docker"><a aria-hidden="true" class="anchor-heading" href="#running-with-docker"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Running with Docker</h2>
<pre class="language-sh"><code class="language-sh">docker run -d \
--name=wireguard \
--cap-add=NET_ADMIN \
--cap-add=SYS_MODULE \
-e PUID=1000 \
-e PGID=1000 \
-e TZ=[YOURTZ] \
-e SERVERURL=[YOURIP] \
-e SERVERPORT=51820 \
-e PEERS=[PEERS] \
-e PEERDNS=auto \
-e INTERNAL_SUBNET=10.13.13.0 \
-p 51820:51820/udp \
-v [VOLUME]:/config \
-v /lib/modules:/lib/modules \
--restart unless-stopped \
linuxserver/wireguard

## e.g.

docker run -d \
--name=wireguard \
--cap-add=NET_ADMIN \
--cap-add=SYS_MODULE \
-e PUID=1000 \
-e PGID=1000 \
-e TZ=Europe/London \
-e SERVERURL=xujunjie-pi.hopto.org \
-e SERVERPORT=51820 \
-e PEERS=3 \
-e PEERDNS=192.168.208.102 \
-e INTERNAL_SUBNET=10.13.13.0 \
-p 51820:51820/udp \
-v /usr/local/docker_apps/wireguard/config:/config \
-v /lib/modules:/lib/modules \
--restart unless-stopped \
linuxserver/wireguard
</code></pre>
<h2 id="output"><a aria-hidden="true" class="anchor-heading" href="#output"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>Output</h2>
<p>After you execute the docker run command, the container will install the required kernel headers for your operating system to be able to effectively run Wireguard. Depending on your system this process could take a few minutes.</p>
<p>After the container setup process is completed, the terminal will display QR codes. Do not close your window, you will need to scan these QR codes later. You can scan these QR codes with the mobile applications to instantly create the Wireguard profile on your mobile devices. The QR codes are the easiest and quickest way to get Wireguard up and running on your mobile devices.</p>
<h2 id="mtu-fixes"><a aria-hidden="true" class="anchor-heading" href="#mtu-fixes"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>MTU fixes</h2>
<pre class="language-sh"><code class="language-sh">## Add the below to the PostUp section of the server config
iptables -A FORWARD -p tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu

## Add the below to the PostDown section of the server config
iptables -D FORWARD -p tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu
</code></pre>
<p><em>Reference: <a href="https://keremerkan.net/posts/wireguard-mtu-fixes/">https://keremerkan.net/posts/wireguard-mtu-fixes/</a></em></p>
<h2 id="references"><a aria-hidden="true" class="anchor-heading" href="#references"><svg aria-hidden="true" viewBox="0 0 16 16"><use xlink:href="#svg-link"></use></svg></a>References</h2>
<p><em><a href="https://codeopolis.com/posts/installing-wireguard-in-docker/">https://codeopolis.com/posts/installing-wireguard-in-docker/</a></em>
<em><a href="https://github.com/linuxserver/docker-wireguard">https://github.com/linuxserver/docker-wireguard</a></em></p></div></div><div style="padding-left:10px;padding-right:10px" class="ant-col ant-col-xs-0 ant-col-md-6"><div><div class=""><div class="ant-anchor-wrapper dendron-toc" style="max-height:calc(100vh - 64px);z-index:1"><div class="ant-anchor"><div class="ant-anchor-ink"><span class="ant-anchor-ink-ball"></span></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#wireguard" title="Wireguard">Wireguard</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#possible-pre-req" title="Possible pre-req">Possible pre-req</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#running-with-docker" title="Running with Docker">Running with Docker</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#output" title="Output">Output</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#mtu-fixes" title="MTU fixes">MTU fixes</a></div><div class="ant-anchor-link"><a class="ant-anchor-link-title" href="#references" title="References">References</a></div></div></div></div></div></div></div></div></div></main><div class="ant-divider ant-divider-horizontal" role="separator"></div><footer class="ant-layout-footer" style="padding:0 24px 24px"></footer></section></section></section></section></div><script id="__NEXT_DATA__" type="application/json">{"props":{"pageProps":{"note":{"id":"792ced21-aea6-42c6-ac34-c4e613bbb374","title":"Wireguard","desc":"","updated":1614451360150,"created":1613812652776,"custom":{},"fname":"app.wireguard","type":"note","vault":{"fsPath":".","name":"vault","selfContained":true},"contentHash":"861f989065805e211bacc852cc3c2b49","links":[],"anchors":{"wireguard":{"type":"header","text":"Wireguard","value":"wireguard","line":8,"column":0,"depth":1},"possible-pre-req":{"type":"header","text":"Possible pre-req","value":"possible-pre-req","line":10,"column":0,"depth":2},"running-with-docker":{"type":"header","text":"Running with Docker","value":"running-with-docker","line":21,"column":0,"depth":2},"output":{"type":"header","text":"Output","value":"output","line":62,"column":0,"depth":2},"mtu-fixes":{"type":"header","text":"MTU fixes","value":"mtu-fixes","line":67,"column":0,"depth":2},"references":{"type":"header","text":"References","value":"references","line":78,"column":0,"depth":2}},"children":[],"parent":"ced683be-fe67-4022-989f-abc6d311cb3a","data":{}},"body":"\u003ch1 id=\"wireguard\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#wireguard\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eWireguard\u003c/h1\u003e\n\u003ch1 id=\"wireguard-1\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#wireguard-1\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eWireguard\u003c/h1\u003e\n\u003ch2 id=\"possible-pre-req\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#possible-pre-req\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003ePossible pre-req\u003c/h2\u003e\n\u003cp\u003eAfter getting a vague error which said \u003ccode\u003eKernel headers not available, sleeping now\u003c/code\u003e, the following possible solution is below\u003c/p\u003e\n\u003cpre class=\"language-sh\"\u003e\u003ccode class=\"language-sh\"\u003e## Not sure if the below fixed it or not but this was run first\nsudo apt install --reinstall libraspberrypi0 libraspberrypi-{bin,dev,doc} raspberrypi-bootloader raspberrypi-kernel\n\n## Running the below and restarting fixed the issue \nsudo apt update \u0026#x26;\u0026#x26; sudo apt upgrade -y\n\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"running-with-docker\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#running-with-docker\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eRunning with Docker\u003c/h2\u003e\n\u003cpre class=\"language-sh\"\u003e\u003ccode class=\"language-sh\"\u003edocker run -d \\\n--name=wireguard \\\n--cap-add=NET_ADMIN \\\n--cap-add=SYS_MODULE \\\n-e PUID=1000 \\\n-e PGID=1000 \\\n-e TZ=[YOURTZ] \\\n-e SERVERURL=[YOURIP] \\\n-e SERVERPORT=51820 \\\n-e PEERS=[PEERS] \\\n-e PEERDNS=auto \\\n-e INTERNAL_SUBNET=10.13.13.0 \\\n-p 51820:51820/udp \\\n-v [VOLUME]:/config \\\n-v /lib/modules:/lib/modules \\\n--restart unless-stopped \\\nlinuxserver/wireguard\n\n## e.g.\n\ndocker run -d \\\n--name=wireguard \\\n--cap-add=NET_ADMIN \\\n--cap-add=SYS_MODULE \\\n-e PUID=1000 \\\n-e PGID=1000 \\\n-e TZ=Europe/London \\\n-e SERVERURL=xujunjie-pi.hopto.org \\\n-e SERVERPORT=51820 \\\n-e PEERS=3 \\\n-e PEERDNS=192.168.208.102 \\\n-e INTERNAL_SUBNET=10.13.13.0 \\\n-p 51820:51820/udp \\\n-v /usr/local/docker_apps/wireguard/config:/config \\\n-v /lib/modules:/lib/modules \\\n--restart unless-stopped \\\nlinuxserver/wireguard\n\u003c/code\u003e\u003c/pre\u003e\n\u003ch2 id=\"output\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#output\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eOutput\u003c/h2\u003e\n\u003cp\u003eAfter you execute the docker run command, the container will install the required kernel headers for your operating system to be able to effectively run Wireguard. Depending on your system this process could take a few minutes.\u003c/p\u003e\n\u003cp\u003eAfter the container setup process is completed, the terminal will display QR codes. Do not close your window, you will need to scan these QR codes later. You can scan these QR codes with the mobile applications to instantly create the Wireguard profile on your mobile devices. The QR codes are the easiest and quickest way to get Wireguard up and running on your mobile devices.\u003c/p\u003e\n\u003ch2 id=\"mtu-fixes\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#mtu-fixes\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eMTU fixes\u003c/h2\u003e\n\u003cpre class=\"language-sh\"\u003e\u003ccode class=\"language-sh\"\u003e## Add the below to the PostUp section of the server config\niptables -A FORWARD -p tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu\n\n## Add the below to the PostDown section of the server config\niptables -D FORWARD -p tcp --tcp-flags SYN,RST SYN -j TCPMSS --clamp-mss-to-pmtu\n\u003c/code\u003e\u003c/pre\u003e\n\u003cp\u003e\u003cem\u003eReference: \u003ca href=\"https://keremerkan.net/posts/wireguard-mtu-fixes/\"\u003ehttps://keremerkan.net/posts/wireguard-mtu-fixes/\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e\n\u003ch2 id=\"references\"\u003e\u003ca aria-hidden=\"true\" class=\"anchor-heading\" href=\"#references\"\u003e\u003csvg aria-hidden=\"true\" viewBox=\"0 0 16 16\"\u003e\u003cuse xlink:href=\"#svg-link\"\u003e\u003c/use\u003e\u003c/svg\u003e\u003c/a\u003eReferences\u003c/h2\u003e\n\u003cp\u003e\u003cem\u003e\u003ca href=\"https://codeopolis.com/posts/installing-wireguard-in-docker/\"\u003ehttps://codeopolis.com/posts/installing-wireguard-in-docker/\u003c/a\u003e\u003c/em\u003e\n\u003cem\u003e\u003ca href=\"https://github.com/linuxserver/docker-wireguard\"\u003ehttps://github.com/linuxserver/docker-wireguard\u003c/a\u003e\u003c/em\u003e\u003c/p\u003e","noteIndex":{"id":"root","title":"root","desc":"","updated":1595961348801,"created":1595961348801,"custom":{"nav_order":0,"permalink":"/"},"fname":"root","type":"note","vault":{"fsPath":".","name":"vault","selfContained":true},"contentHash":"dad9815845eec627c937e34281a065d5","links":[],"anchors":{"root":{"type":"header","text":"Root","value":"root","line":8,"column":0,"depth":1}},"children":["ced683be-fe67-4022-989f-abc6d311cb3a","132fe0fe-fc74-4dbe-982a-9dcac677f664","a44df307-1a67-417b-b733-da109c3be441","b9686e84-d9a1-4dbb-8474-1a9c156d6d12","93a5dc42-8663-4d3c-924f-82e8faa35a67","f80d45a1-bd90-4097-96bc-0301fbc4d937","19992660-3602-4c64-a3a5-e9c05f19ffac","3f157f98-5c61-4479-b311-956d4b0ef67a"],"parent":null,"data":{},"body":"\n# Root\n\nThis is the root fo your dendron vault. If you decide to publish your entire vault, this will be your landing page. You are free to customize any part of this page except the frontmatter on top. \n"},"collectionChildren":null,"customHeadContent":null,"config":{"version":5,"dev":{"enablePreviewV2":true},"commands":{"lookup":{"note":{"selectionMode":"extract","confirmVaultOnCreate":false,"leaveTrace":true,"bubbleUpCreateNew":true,"vaultSelectionModeOnCreate":"smart","fuzzThreshold":0.2}},"randomNote":{},"insertNote":{"initialValue":"templates"},"insertNoteLink":{"aliasMode":"none","enableMultiSelect":false},"insertNoteIndex":{"enableMarker":false},"copyNoteLink":{}},"workspace":{"vaults":[{"fsPath":".","name":"vault","selfContained":true}],"journal":{"dailyDomain":"daily","name":"journal","dateFormat":"y.MM.dd","addBehavior":"childOfDomain"},"scratch":{"name":"scratch","dateFormat":"y.MM.dd.HHmmss","addBehavior":"asOwnDomain"},"task":{"name":"","dateFormat":"","addBehavior":"childOfCurrent","statusSymbols":{"":" ","wip":"w","done":"x","assigned":"a","moved":"m","blocked":"b","delegated":"l","dropped":"d","pending":"y"},"prioritySymbols":{"H":"high","M":"medium","L":"low"},"todoIntegration":false,"createTaskSelectionType":"selection2link"},"graph":{"zoomSpeed":1},"enableAutoCreateOnDefinition":false,"enableXVaultWikiLink":false,"enableRemoteVaultInit":true,"enableUserTags":true,"enableHashTags":true,"workspaceVaultSyncMode":"noCommit","enableAutoFoldFrontmatter":false,"maxPreviewsCached":10,"maxNoteLength":204800,"dendronVersion":"0.87.3","enableEditorDecorations":true,"enableFullHierarchyNoteTitle":false},"preview":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"automaticallyShowPreview":false,"enableFrontmatterTags":true,"enableHashesForFMTags":false},"publishing":{"enableFMTitle":true,"enableNoteTitleForLink":true,"enableMermaid":true,"enablePrettyRefs":true,"enableKatex":true,"assetsPrefix":"/dendron-notes","copyAssets":true,"siteHierarchies":["root"],"enableSiteLastModified":true,"siteRootDir":"docs","siteUrl":"https://jackyhui96.github.io","enableFrontmatterTags":true,"enableHashesForFMTags":false,"enableRandomlyColoredTags":true,"duplicateNoteBehavior":{"action":"useVault","payload":["vault"]},"writeStubs":false,"seo":{"title":"Dendron Notes","description":"Personal knowledge space"},"github":{"enableEditLink":true,"editLinkText":"Edit this page on GitLab","editBranch":"main","editViewMode":"tree"},"enablePrettyLinks":true,"siteFaviconPath":"favicon.ico","siteIndex":"root"}}},"__N_SSG":true},"page":"/notes/[id]","query":{"id":"792ced21-aea6-42c6-ac34-c4e613bbb374"},"buildId":"n99zhAM-gKPmAIazFHerv","assetPrefix":"/dendron-notes","isFallback":false,"gsp":true,"scriptLoader":[]}</script></body></html>