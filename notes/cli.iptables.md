---
id: yPSbfSUiv5mdVJHX2LaBF
title: Iptables
desc: ''
updated: 1624740148102
created: 1624732067440
---

# Overview
- iptables - administration tool for IPv4 packet filtering and NAT

# Synopsis
```
iptables [-t table] -[AD] chain rule-specification [options]
```

# Options

## Flags
- `-t | --table <table>`: This option specifies the packet matching table which the command should operate on.

## Tables
The tables are as follows:

`filter`:
This is the **default table** (if no `-t` option is passed).
- INPUT (for packets destined to local sockets)
- FORWARD (for packets being routed through the box)
- OUTPUT (for locally-generated packets)

`nat`:
This table is consulted when a packet that creates a new connection is encountered.
- PREROUTING (for altering packets as soon as they come in)
- OUTPUT (for altering locally-generated packets before routing)
- POSTROUTING (for altering packets as they are about to go out)

`mangle`:
This table is used for specialized packet alteration. Until kernel 2.4.17 it had two built-in chains: 
- PREROUTING (for altering incoming packets before routing)
- OUTPUT (for altering locally-generated packets before routing). 

Since kernel 2.4.18, three other built-in chains are also supported: 
- INPUT (for packets coming into the box itself)
- FORWARD (for altering packets being routed through the box)
- POSTROUTING (for altering packets as they are about to go out)

`raw`:
This table is used mainly for configuring exemptions from connection tracking in combination with the NOTRACK target. It registers at the netfilter hooks with higher priority and is thus called before ip_conntrack, or any other IP tables.
- PREROUTING (for packets arriving via any network interface)
- OUTPUT (for packets generated by local processes)

# Examples
```sh
## List Rules
iptables -L --line-numbers

## List Rules in nat table
sudo iptables -t nat -L -n

## Delete a rule by number
iptables -D [CHAIN NAME] [RULE NUMBER]
## e.g. Delete 11th rule at the "FORWARD" chain.
iptables -D FORWARD 11

## Port forward to another IP
## TCP
iptables -t nat -I PREROUTING -p tcp -m tcp --dst <node_a> --dport <port_a>[:<port_b>] -j DNAT --to-destination <node_b>:<port_a>[-<port_b>]
iptables -t nat -A POSTROUTING -m tcp -p tcp --dst <node_b> --dport <port_a>[:<port_b>] -j SNAT --to-source <node_a>
## Not sure if need the below
iptables -A FORWARD -m tcp -p tcp --dst <node_b> --dport <port_a>:<port_b> -j ACCEPT
## e.g. NodeA (192.168.0.3:31000-31999) -> NodeB (172.20.0.11:31000-31999)
iptables -t nat -I PREROUTING -p tcp -m tcp --dst 192.168.0.3 --dport 31000:31999 -j DNAT --to-destination 172.20.0.11:31000-31999
iptables -t nat -A POSTROUTING -m tcp -p tcp --dst 172.20.0.11 --dport 31000:31999 -j SNAT --to-source 192.168.0.3
iptables -A FORWARD -m tcp -p tcp --dst 172.20.0.11 --dport  31000:31999 -j ACCEPT
## Another example with masqerade: 3124 -> 1.1.1.1:3000
iptables -t nat -A PREROUTING -p tcp --dport 3124 -j DNAT --to-destination 1.1.1.1:3000
iptables -t nat -A POSTROUTING -j MASQUERADE
```

# Other Notes

## IP Forwarding
NAT uses IP forwarding and by default itâ€™s not enabled in the kernel parameters

### Check if IP forwarding is enabled
```sh
## CentOS/RHEL
sysctl net.ipv4.ip_forward
## Debian:
sudo sysctl net.ipv4.ip_forward
## Return: net.ipv4.ip_forward = 0   # where 0 means disabled
net.ipv4.ip_forward = 0
```

### Enable IP forwarding
```sh
### To enable IP persistently (survives a reboot):
## CentOS/RHEL:
echo "net.ipv4.ip_forward = 1"|sudo tee /etc/sysctl.d/99-ipforward.conf
## Debian:
sudo sed -i 's/#net.ipv4.ip_forward=1/net.ipv4.ip_forward=1/g' /etc/sysctl.conf

### To activate the changes immediately afer making the aboves changes:
## CentOS/RHEL:
sudo sysctl -p /etc/sysctl.d/99-ipforward.conf
## Debian:
sudo sysctl -p
```
